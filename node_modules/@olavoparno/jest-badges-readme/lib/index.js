#!/usr/bin/env node
var e=require("fs"),t=function(e,t,r){return"https://img.shields.io/badge/"+e+"-"+t+"-"+r+".svg"},r=["branches","functions","lines","statements"],o=new function(){var o=this;this.reportKeys=r,this.createReadme=function(t){return void 0===t&&(t="./README-template.md"),e.existsSync(t)?(e.copyFileSync(t,"./README.md"),console.log("[1m[32m","Template read succesfully. ./README.md created!"),!0):(console.log("[1m[31m","Error: ./README-template.md file not not found."),console.log("[1m[32m","You must have a ./README-template.md created. Please read the documentation."),!1)},this.insertBadges=function(t){void 0===t&&(t="./coverage/coverage-summary.json");var r=!1,n=o.getCoveragePath(t);if(e.existsSync(n)){var a=e.readFileSync(n,"utf8");if(!a.length)return console.log("[1m[31m","Malformed coverage report. Please run Jest again"),!1;console.log("[1m[32m","Reading coverage file from "+n);var i=JSON.parse(a),s=e.readFileSync("./README.md","utf8");o.reportKeys.forEach(function(t){var n=o.getBadge(i,t);n.length?(s=s.replace("#"+t+"#",n),console.log("[1m[32m","Badge for",t,"updated with:",n),r=!0,e.writeFileSync("./README.md",s,"utf8")):r=!1}),o.getBuildStatus()}else console.log("[1m[31m","Error: "+n+" file not found. Is it at the default location?"),console.log("[1m[33m","Do you have Jest installed? If so, is it properly configured? If you do, then run me"),console.log("[1m[33m","by passing args i.e. npm run jest-badges-readme --coverageDir='my-custom-coverage-folder'"),r=!1;return r},this.getBuildStatus=function(r){void 0===r&&(r="./.buildstatus");var o=t("Build","Passing","brightgreen"),n=!1;if(e.existsSync(r)){var a=e.readFileSync("./README.md","utf8"),i=e.readFileSync(r,"utf8");"ok"===i?(o=t("Build","Passing","brightgreen"),n=!0):"nok"===i&&(o=t("Build","Failing","brightred"),n=!1),a=a.replace("#buildstatus#",o),e.writeFileSync("./README.md",a,"utf8"),console.log("[1m[32m","Writing building status",i,"with URL:",o)}else n=!1;return n},this.getCoveragePath=function(e){var t=e,r="",o=process.argv.filter(function(e){if(e.indexOf("coverage")>=0)return e}).toString();return o&&(r=o.replace("--coverageDir=","")),r&&o.length>0&&(t=r+"/coverage-summary.json"),t},this.getBadge=function(e,t){if(!(e&&e.total&&e.total[t]))return console.log("[1m[31m","Malformed coverage report for the key "+t+". Please run Jest again."),"";var r=e.total[t].pct;return function(e,t){return"https://img.shields.io/badge/Coverage-"+e+encodeURI("%")+"-"+t+".svg"}(r,o.getColor(r))},this.getColor=function(e){return e<80?"red":e<90?"yellow":"brightgreen"}};o.createReadme()&&o.insertBadges();
//# sourceMappingURL=index.js.map
