#!/usr/bin/env node
import{existsSync as e,copyFileSync as t,readFileSync as o,writeFileSync as r}from"fs";var n=function(e,t,o){return"https://img.shields.io/badge/"+e+"-"+t+"-"+o+".svg"},a=["branches","functions","lines","statements"],i=new function(){var i=this;this.reportKeys=a,this.createReadme=function(o){return void 0===o&&(o="./README-template.md"),e(o)?(t(o,"./README.md"),console.log("[1m[32m","Template read succesfully. ./README.md created!"),!0):(console.log("[1m[31m","Error: ./README-template.md file not not found."),console.log("[1m[32m","You must have a ./README-template.md created. Please read the documentation."),!1)},this.insertBadges=function(t){void 0===t&&(t="./coverage/coverage-summary.json");var n=!1,a=i.getCoveragePath(t);if(e(a)){var s=o(a,"utf8");if(!s.length)return console.log("[1m[31m","Malformed coverage report. Please run Jest again"),!1;console.log("[1m[32m","Reading coverage file from "+a);var l=JSON.parse(s),g=o("./README.md","utf8");i.reportKeys.forEach(function(e){var t=i.getBadge(l,e);t.length?(g=g.replace("#"+e+"#",t),console.log("[1m[32m","Badge for",e,"updated with:",t),n=!0,r("./README.md",g,"utf8")):n=!1}),i.getBuildStatus()}else console.log("[1m[31m","Error: "+a+" file not found. Is it at the default location?"),console.log("[1m[33m","Do you have Jest installed? If so, is it properly configured? If you do, then run me"),console.log("[1m[33m","by passing args i.e. npm run jest-badges-readme --coverageDir='my-custom-coverage-folder'"),n=!1;return n},this.getBuildStatus=function(t){void 0===t&&(t="./.buildstatus");var a=n("Build","Passing","brightgreen"),i=!1;if(e(t)){var s=o("./README.md","utf8"),l=o(t,"utf8");"ok"===l?(a=n("Build","Passing","brightgreen"),i=!0):"nok"===l&&(a=n("Build","Failing","brightred"),i=!1),s=s.replace("#buildstatus#",a),r("./README.md",s,"utf8"),console.log("[1m[32m","Writing building status",l,"with URL:",a)}else i=!1;return i},this.getCoveragePath=function(e){var t=e,o="",r=process.argv.filter(function(e){if(e.indexOf("coverage")>=0)return e}).toString();return r&&(o=r.replace("--coverageDir=","")),o&&r.length>0&&(t=o+"/coverage-summary.json"),t},this.getBadge=function(e,t){if(!(e&&e.total&&e.total[t]))return console.log("[1m[31m","Malformed coverage report for the key "+t+". Please run Jest again."),"";var o=e.total[t].pct;return function(e,t){return"https://img.shields.io/badge/Coverage-"+e+encodeURI("%")+"-"+t+".svg"}(o,i.getColor(o))},this.getColor=function(e){return e<80?"red":e<90?"yellow":"brightgreen"}};i.createReadme()&&i.insertBadges();
//# sourceMappingURL=index.mjs.map
